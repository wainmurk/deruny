<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏</title>
  <meta name="robots" content="noindex,nofollow">
  <link rel="icon" type="image/png" href="/favicon.png">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fira+Code&display=swap');
    :root{--accent:#00ff88}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:#0b0d12;color:#e5ffee;font-family:'Fira Code',monospace}
    .wrap{max-width:1200px;margin:0 auto;padding:20px}
    h1{margin:10px 0 6px}
    .muted{opacity:.75}
    .btn{display:inline-block;background:rgba(0,255,136,.12);border:1px solid var(--accent);color:var(--accent);padding:.5rem .9rem;border-radius:10px;text-decoration:none;cursor:pointer}
    .btn:hover{background:rgba(0,255,136,.22)}
    .card{background:#141826;border:1px solid #1f2740;border-radius:14px;box-shadow:0 0 18px rgba(0,255,136,.08);padding:16px}
    .pdf-card{background:#141826;border:1px solid #1f2740;border-radius:14px;box-shadow:0 0 18px rgba(0,255,136,.08);padding:14px;margin:16px 0}
    .pdf-head{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .pdf-title{font-weight:600}
    .pdf-meta{font-size:.85rem;opacity:.8}
    .pdf-embed{margin-top:10px;border:1px solid #263054;border-radius:10px;overflow:hidden;background:#0e1322}
    .pdf-embed iframe{width:100%;height:80vh;border:0;background:#0e1322}
    input[type=password]{width:260px;padding:.6rem .8rem;border-radius:10px;border:1px solid #2a3558;background:#0e1322;color:#e5ffee}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    @media (max-width:900px){ .pdf-embed iframe{height:70vh} }
    @media (max-width:600px){ .pdf-embed iframe{height:65vh} }
  </style>
</head>
<body>
  <div class="wrap">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <h1>üîê –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏</h1>
      <a class="btn" href="index.html">‚Üê –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
    </div>

    <!-- –ü–∞—Ä–æ–ª—å -->
    <div id="gate" class="card">
      <div class="row">
        <label class="muted">–ü–∞—Ä–æ–ª—å:</label>
        <input id="pwd" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        <button id="enterBtn" class="btn">–£–≤—ñ–π—Ç–∏</button>
      </div>
      <p id="msg" class="muted" style="margin-top:8px"></p>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
    <div id="content" style="display:none">
      <p class="muted">–£—Å—ñ PDF –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –∑ Google Drive –∑–∞ <code>fileId</code> –∑ <code>/certs/manifest.json</code> —ñ –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è –ø–æ—Å–ø—ñ–ª—å (lazy-load).</p>
      <div id="list"></div>
      <p id="status" class="muted"></p>
    </div>
  </div>

<script>
// ======= –ü–∞—Ä–æ–ª—å: 2402 (SHA-256 –ø—Ä–æ–≤–µ—Ä–∫–∏) =======
const PASSWORD_SHA256_HEX = '4708f9c61a5e58b72774193f69bf37442423a4d2673e1f2cdc3f07f2614aba5d';

const gate = document.getElementById('gate');
const content = document.getElementById('content');
const msg = document.getElementById('msg');
const pwd = document.getElementById('pwd');
const enterBtn = document.getElementById('enterBtn');

enterBtn.onclick = async ()=>{
  const ok = (await sha256Hex(pwd.value||'')) === PASSWORD_SHA256_HEX;
  if(!ok){ msg.textContent = '–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å.'; return; }
  gate.style.display='none';
  content.style.display='block';
  loadAll();
};
pwd.addEventListener('keydown',e=>{ if(e.key==='Enter') enterBtn.click(); });

async function sha256Hex(text){
  const buf = new TextEncoder().encode(text);
  const digest = await crypto.subtle.digest('SHA-256', buf);
  return [...new Uint8Array(digest)].map(b=>b.toString(16).padStart(2,'0')).join('');
}

// ======= –†–µ–Ω–¥–µ—Ä PDF –∏–∑ Drive =======
async function loadAll(){
  const listEl = document.getElementById('list');
  const statusEl = document.getElementById('status');

  const io = new IntersectionObserver((entries)=>{
    entries.forEach(e=>{
      if(e.isIntersecting){
        const holder = e.target;
        if(holder.dataset.src && !holder.dataset.loaded){
          const ifr = document.createElement('iframe');
          ifr.src = holder.dataset.src; // —É–∂–µ —Å /preview
          ifr.setAttribute('loading','lazy');
          holder.appendChild(ifr);
          holder.dataset.loaded = '1';
        }
      }
    });
  }, {rootMargin:'200px 0px'});

  function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}

  function createCard(item){
    const title = item.title || item.fileId;
    const openUrl = `https://drive.google.com/file/d/${item.fileId}/view`;
    const previewUrl = `https://drive.google.com/file/d/${item.fileId}/preview`;

    const card = document.createElement('div');
    card.className = 'pdf-card';
    card.innerHTML = `
      <div class="pdf-head">
        <div>
          <div class="pdf-title">${escapeHtml(title)}</div>
          <div class="pdf-meta">${item.updated?`–æ–Ω–æ–≤–ª–µ–Ω–æ: ${escapeHtml(item.updated)} ‚Ä¢ `:''}<span>Google Drive</span></div>
        </div>
        <div class="row">
          <a class="btn" href="${openUrl}" target="_blank" rel="noopener">–í—ñ–¥–∫—Ä–∏—Ç–∏</a>
        </div>
      </div>
      <div class="pdf-embed">
        <div class="holder" data-src="${previewUrl}"></div>
      </div>`;
    const holder = card.querySelector('.holder');
    io.observe(holder);
    return card;
  }

  try{
    statusEl.textContent = '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É‚Ä¶';
    const r = await fetch('/certs/manifest.json', {cache:'no-store'});
    if(!r.ok) throw new Error('manifest.json –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
    const manifest = await r.json();
    const files = (manifest.files||[]).filter(f => typeof f.fileId==='string' && f.fileId.length>0);
    if(files.length===0){ statusEl.textContent='–£ –º–∞–Ω—ñ—Ñ–µ—Å—Ç—ñ –Ω–µ–º–∞—î —Ñ–∞–π–ª—ñ–≤.'; return; }
    statusEl.textContent = `–ó–Ω–∞–π–¥–µ–Ω–æ ${files.length} —Ñ–∞–π–ª(–∏).`;
    files.forEach(it => listEl.appendChild(createCard(it)));
  }catch(e){
    statusEl.textContent = '–ü–æ–º–∏–ª–∫–∞: ' + e.message;
    console.error(e);
  }
}
</script>
</body>
</html>
