<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏</title>
  <link rel="icon" type="image/png" href="/favicon.png">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fira+Code&display=swap');
    :root{--accent:#00ff88}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:#0b0d12;color:#e5ffee;font-family:'Fira Code',monospace}
    .wrap{max-width:1200px;margin:0 auto;padding:20px}
    h1{margin:10px 0 6px}
    .muted{opacity:.75}
    .btn{display:inline-block;background:rgba(0,255,136,.12);border:1px solid var(--accent);
         color:var(--accent); padding:.5rem .9rem; border-radius:10px; text-decoration:none}
    .btn:hover{background:rgba(0,255,136,.22)}
    .pdf-card{background:#141826;border:1px solid #1f2740;border-radius:14px;
              box-shadow:0 0 18px rgba(0,255,136,.08); padding:14px; margin:16px 0}
    .pdf-head{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .pdf-title{font-weight:600}
    .pdf-meta{font-size:.85rem;opacity:.8}
    .pdf-embed{margin-top:10px;border:1px solid #263054;border-radius:10px;overflow:hidden;background:#0e1322}
    .pdf-embed iframe,.pdf-embed embed{width:100%;height:80vh;border:0;background:#0e1322}
    .fallback{padding:12px;border:1px dashed #263054;border-radius:10px;margin-top:10px}
    @media (max-width:900px){ .pdf-embed iframe,.pdf-embed embed{height:70vh} }
    @media (max-width:600px){ .pdf-embed iframe,.pdf-embed embed{height:65vh} }
  </style>
</head>
<body>
  <div class="wrap">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <h1>üìÑ –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏</h1>
      <div>
        <a class="btn" href="index.html">‚Üê –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
      </div>
    </div>
    <p class="muted">–£—Å—ñ PDF –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –∑ <code>/certs/</code> —ñ –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è –ø–æ—Å–ø—ñ–ª—å. 
      –©–æ–± –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ ‚Äî –ø–æ–∫–ª–∞–¥—ñ—Ç—å —ó—Ö –¥–æ –ø–∞–ø–∫–∏ —Ç–∞ –æ–Ω–æ–≤—ñ—Ç—å <code>manifest.json</code>.</p>

    <div id="list"></div>
    <p id="status" class="muted"></p>
  </div>

<script>
(async function(){
  const listEl = document.getElementById('list');
  const statusEl = document.getElementById('status');

  // –≥—Ä—É–∑–∏–º –º–∞–Ω–∏—Ñ–µ—Å—Ç
  async function loadManifest(){
    const r = await fetch('/certs/manifest.json', {cache: 'no-store'});
    if(!r.ok) throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ manifest.json');
    return r.json();
  }

  // lazy –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ iframe, —á—Ç–æ–±—ã –Ω–µ –≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Å—Ä–∞–∑—É
  const io = new IntersectionObserver((entries)=>{
    entries.forEach(e=>{
      if(e.isIntersecting){
        const holder = e.target;
        if(holder.dataset.src && !holder.dataset.loaded){
          const src = holder.dataset.src;
          // –ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ <iframe>
          const ifr = document.createElement('iframe');
          // –°–∫—Ä—ã–≤–∞–µ–º —Ç—É–ª–±–∞—Ä viewer (–Ω–µ –∑–∞—â–∏—Ç–∞, –ø—Ä–æ—Å—Ç–æ —á–∏—â–µ UI)
          ifr.src = src + '#toolbar=0&navpanes=0&scrollbar=0';
          ifr.setAttribute('loading','lazy');
          ifr.onerror = ()=> showFallback(holder, src);
          holder.appendChild(ifr);
          holder.dataset.loaded = '1';
        }
      }
    });
  }, {rootMargin: '200px 0px'});

  function showFallback(holder, src){
    holder.innerHTML = `
      <div class="fallback">
        –ù–µ –≤–¥–∞–ª–æ—Å—è –≤–±—É–¥—É–≤–∞—Ç–∏ PDF —É –ø–µ—Ä–µ–≥–ª—è–¥–∞—á. 
        <a class="btn" href="${src}" target="_blank" rel="noopener">–í—ñ–¥–∫—Ä–∏—Ç–∏ —É –Ω–æ–≤—ñ–π –≤–∫–ª–∞–¥—Ü—ñ</a>
      </div>`;
  }

  function createCard(item){
    const card = document.createElement('div');
    card.className = 'pdf-card';

    const title = item.title || item.file;
    const meta = [];
    if(item.file) meta.push(item.file);
    if(item.updated) meta.push(`–æ–Ω–æ–≤–ª–µ–Ω–æ: ${item.updated}`);

    card.innerHTML = `
      <div class="pdf-head">
        <div>
          <div class="pdf-title">${escapeHtml(title)}</div>
          <div class="pdf-meta">${escapeHtml(meta.join(' ‚Ä¢ '))}</div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <a class="btn" href="/certs/${encodeURIComponent(item.file)}" target="_blank" rel="noopener">–í—ñ–¥–∫—Ä–∏—Ç–∏</a>
        </div>
      </div>
      <div class="pdf-embed"><div class="embed-holder" data-src="/certs/${encodeURIComponent(item.file)}"></div></div>
    `;
    const holder = card.querySelector('.embed-holder');
    io.observe(holder);
    return card;
  }

  function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}

  try{
    statusEl.textContent = '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É‚Ä¶';
    const manifest = await loadManifest();
    const files = (manifest.files||[]).filter(f=>typeof f.file==='string');
    if(files.length===0){
      statusEl.textContent = '–£ –º–∞–Ω—ñ—Ñ–µ—Å—Ç—ñ –Ω–µ–º–∞—î —Ñ–∞–π–ª—ñ–≤.';
      return;
    }
    statusEl.textContent = `–ó–Ω–∞–π–¥–µ–Ω–æ ${files.length} —Ñ–∞–π–ª(–∏).`;
    files.forEach(item => listEl.appendChild(createCard(item)));
  }catch(e){
    console.error(e);
    statusEl.textContent = '–ü–æ–º–∏–ª–∫–∞: ' + e.message;
  }
})();
</script>
</body>
</html>
